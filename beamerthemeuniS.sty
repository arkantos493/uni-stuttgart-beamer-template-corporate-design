% !TeX root = slides.tex

% Copyright 2017 by Christian Senger <senger@inue.uni-stuttgart.de>
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/licenses/LICENSE for more details.

% reset footnote counter per page, adapt footnotes
\usepackage{perpage}
\MakePerPage{footnote}
\renewcommand*{\thefootnote}{\fnsymbol{footnote}}
\renewcommand\footnoterule{}

% set up fonts
\usepackage{lmodern}
\usepackage{csquotes}

\usepackage{iftex}
\ifLuaTeX

\usepackage{fontspec}
\setsansfont[
BoldFont = UniversforUniS65Bd-Regular,
ItalicFont = UniversforUniS45LtObl-Rg,
BoldItalicFont = UniversforUniS45LtObl-Rg,
Scale = MatchUppercase
]{UniversforUniS55Rm-Regular}

\renewcommand{\familydefault}{\sfdefault}

\else

\usepackage[T1]{fontenc}
\usepackage{inputenc}

\fi


% fix some latex quirks
\usepackage{xspace}
\usepackage[xspace]{ellipsis}
\usepackage{fixmath}
\usepackage[stretch=10]{microtype}


% use fancy enumerate/itemize and restore beamer layout
\usepackage{enumitem}\setitemize{%
  label=\usebeamerfont*{itemize item}
  \usebeamercolor[fg]{itemize item}
  \usebeamertemplate{itemize item}
}

% necessary packages
\usepackage{academicons}
\usepackage{appendixnumberbeamer}
\usepackage{biblatex}
\usepackage{etoolbox}
\usepackage{phonenumbers}
\usepackage{qrcode}
\usepackage{tikz}
\usepackage{xargs}
\usepackage{xifthen}
\usepackage{xstring} % switch case over parameters in \newcommand
\usepackage{fontawesome5}
\usepackage{tabularx}


\definecolor{orcidlogocol}{HTML}{A6CE39}


\makeatletter
\def\beamerrightmargin{\dimexpr\Gm@rmargin\relax}
\makeatother

\makeatletter
\newcommand\changemode[1]{%
	\gdef\beamer@currentmode{#1}}
\makeatother


\mode<presentation>

\useoutertheme{uniS}
\useinnertheme{rectangles}

\usecolortheme{uniS}

\usefonttheme[onlymath]{serif}
\setbeamerfont{block title}{size=\small}

\setbeamersize{text margin left=1cm}
\setbeamersize{text margin right=1cm}

\setbeamertemplate{navigation symbols}{}


% define a few pictures used throughout the slides
\iflanguage{ngerman}{
	\def\university{Universität Stuttgart}
}{
	\def\university{University of Stuttgart}
}


\pgfdeclareimage[height=1cm]{unilogo}{.logos/unilogo\iflanguage{ngerman}{}{_en}.pdf}
\pgfdeclareimage[height=1cm]{unilogo_w}{.logos/unilogo_w\iflanguage{ngerman}{}{_en}.pdf}
\def\universitylink{https://www.uni-stuttgart.de/\iflanguage{ngerman}{}{en/}}

% TODO: besser
% automatically display \sectionpage at beginning of every \section{}
\AtBeginSection[]{%
	\begin{frame}[plain]
		\sectionpage
	\end{frame}
	% uncomment block in order to display toc after every sectionpage
	%\begin{frame}[c, plain]
	%  \tableofcontents[currentsection]
	%\end{frame}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% title page %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatletter
\newcommand{\cclicense}[2][]{
	%% get version, if version is unsupported, throw error
	\IfStrEqCase{#1}{%
		{}{\def\ccversion{4.0}}
		{4.0}{\def\ccversion{4.0}}
		{3.0}{\def\ccversion{3.0}}
		{2.5}{\def\ccversion{2.5}}
		{2.0}{\def\ccversion{2.0}}
		{1.0}{\def\ccversion{1.0}}} 
		[\PackageError{CC License}{Illegal Creative Commons License Version!}{}]
	
	%% get license, if license is unsupported, throw error
	\IfStrEqCase{#2}{% 
		{by}{\def\cctype{by}}
		{by-nc}{\def\cctype{by-nc}}
		{by-nc-nd}{\def\cctype{by-nc-nd}}
		{by-nc-na}{\def\cctype{by-nc-na}}
		{by-nd}{\def\cctype{by-nd}} 
		{by-sa}{\def\cctype{by-sa}} 
		{cc0}{\def\cctype{cc-zero}} 
		{cc-zero}{\def\cctype{cc-zero}}}
		[\PackageError{CC License}{Illegal Creative Commons License Type!}{}]
	
	%% get license url
	\def\cclang{\iflanguage{ngerman}{german}{\languagename}}
	\gdef\@cclicenselink{https://creativecommons.org/licenses/\cctype/\ccversion/deed.\cclang}
	
	%% get license file
	\gdef\@cclicenseimage{.license/\cctype.png}
}

\newcommand{\backgroundimage}[1]{
	%% check if the given image exists, throw error otherwise
	\IfFileExists{#1}{
		\gdef\@backgroundimage{#1}
	}{
		\PackageError{Title Slide Background Image}{No such file '#1'!}{}
	}
}

\renewcommand{\institute}[2][]{
	%% define short and long name for institute
	\gdef\@institute{#2}
	\ifthenelse{\isempty{#1}}{}{\gdef\@institutefooter{#1}}
}
\renewcommand{\insertinstitute}{\ifdef{\@institute}{\@institute}{}}
\renewcommand{\insertshortinstitute}{\ifdef{\@institutefooter}{\@institutefooter}{\insertinstitute}}

\newcommand{\department}[3][]{
	%% define short and long name for department
	\gdef\@department{#2}
	\ifthenelse{\isempty{#1}}{}{\gdef\@departmentfooter{#1}}
}
\newcommand{\insertdepartment}{\ifdef{\@department}{\@department}{}}
\newcommand{\insertshortdepartment}{\ifdef{\@departmentfooter}{\@departmentfooter}{\insertdepartment}}


\newlength{\circlesize}
\setbeamertemplate{title page}
{
	%% chech if the required values "title" and "author" are set
	\ifdefempty{\inserttitle}{\PackageError{Title}{Missing title!}{}}{}
	\setbox0=\hbox{\insertauthor\unskip}\ifdim\wd0=0pt
		\PackageError{Author}{Missing author!}{}
	\fi
	
	%% the title page shouldn't count for the slide counter
	\addtocounter{framenumber}{-1}
 	\setlength{\circlesize}{1.12\textheight}
 	\begin{tikzpicture}[overlay, remember picture]
    	\clip (current page.north west) rectangle (current page.south east);
		
		%% background image
    	\ifdef{\@backgroundimage}{
		
			\node[anchor=north west] at ([xshift=-1em, yshift=1ex] current page.north west){\includegraphics[width=\textwidth+1em+2\beamerrightmargin]{\@backgroundimage}};
			
			\node[%
			  rectangle,
			  draw=white,
			  fill=white,
			  anchor=north west,
			  minimum width=2\textwidth,
			  minimum height=3cm]
			at (current page.north west) {};
		}{
			\shade[%
			  top color=uniSlightblue,
			  bottom color=uniSblue,
			  shading angle=-45]
			(current page.north west) rectangle (current page.south east);
		}
	
		%% uni logo
		\node[anchor=north west] (logo) at ([xshift=1cm, yshift=-1cm] current page.north west) {\href{\universitylink}{\pgfuseimage{\ifdef{\@backgroundimage}{unilogo}{unilogo_w}}}};

		%% title
		\node[%
		  circle,
		  fill=uniSgray,
		  text=white,
		  anchor=south east,
		  minimum size=\circlesize,
		  align=left,
		  font=\bfseries\Huge]
		(title) at ([yshift=-.05\circlesize] current page.south east) {\inserttitle};
		
		\setlength{\circlesize}{.2\textheight}

		%% author
		\node[%
		  circle,
		  fill=white,
		  anchor=center,
		  minimum size=\circlesize,
		  align=center,
		  font=\bfseries\normalsize]
		(author) at ([xshift=-.1\circlesize, yshift=-.6\circlesize] title.north west) {\insertauthor};
      
		\ifdef{\@cclicenseimage}{
			\node[inner sep=0pt, outer sep=0pt, anchor=south west] at (current page.south west) {\href{\@cclicenselink}{\includegraphics[width=1.75cm]{\@cclicenseimage}}};
		}{}
	\end{tikzpicture}
}
\makeatother

\newcommand{\titleslide}{
	\begin{frame}[plain]
		\maketitle
	\end{frame}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%% table of contents slide %%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\tocslide}[1][]{
	\ifthenelse{\isempty{#1}}{
		\iflanguage{ngerman}{
			\def\toctitle{Übersicht}
		}{
			\def\toctitle{Overview}
		}
	}{
		\def\toctitle{#1}
	}
	
	\begin{frame}{\toctitle}
		\tableofcontents
	\end{frame}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% finalslide %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatletter
\newcommand{\speakerimage}[1]{\gdef\@speakerimage{#1}}

\newcommand{\email}[2][]{
	\ifthenelse{\equal{#1}{usetxt}}{
		\gdef\@emailicon{\iflanguage{ngerman}{E-Mail}{email}}
	}{
		\gdef\@emailicon{\faIcon[regular]{envelope}}
	}
	\gdef\@email{\href{mailto:#2}{#2}}
}

\newcommand{\phone}[2][]{
	\ifthenelse{\equal{#1}{usetxt}}{
		\gdef\@phoneicon{\iflanguage{ngerman}{Telefon}{phone}}
	}{
		\gdef\@phoneicon{\faIcon{phone}}
	}
	\gdef\@phone{\phonenumber{#2}}
}

\renewcommand{\fax}[2][]{
	\ifthenelse{\equal{#1}{usetxt}}{
		\gdef\@faxicon{\iflanguage{ngerman}{Fax}{fax}}
	}{
		\gdef\@faxicon{\faIcon{fax}}
	}
	\gdef\@fax{#2}
}


\newcommand{\address}[4][]{
	\ifthenelse{\equal{#1}{usetxt}}{
		\gdef\@addressicon{\iflanguage{ngerman}{Adresse}{address}}
	}{
		\gdef\@addressicon{\faIcon{map-marker-alt}}
	}
	\gdef\@street{#2}
	\gdef\@zip{#3}
	\def\room{\iflanguage{ngerman}{Raum}{Room}:}
	\gdef\@address{\href{http://maps.google.com/?q=#2+#3}{\makecell[tl]{#2\\#3\\\room #4}}}
}

\newcommand{\officehours}[2][]{
	\ifthenelse{\equal{#1}{usetxt}}{
		\gdef\@officehoursicon{\iflanguage{ngerman}{Sprechstunden}{office hours}}
	}{
		\gdef\@officehoursicon{\faIcon[regular]{calendar-check}}
	}
	\gdef\@officehours{#2}
}

\newcommand{\website}[2][]{
	\ifthenelse{\equal{#1}{usetxt}}{
		\gdef\@websiteicon{\iflanguage{ngerman}{Website}{website}}
	}{
		\gdef\@websiteicon{\faIcon{link}}
	}
	\gdef\@website{\url{#2}}
	\gdef\@websiteqr{\textcolor{white}{\qrcode[height=1.25cm]{#2}}}
}

\newcommand{\orcid}[2][]{
	\ifthenelse{\equal{#1}{usetxt}}{
		\gdef\@orcidicon{ORCID}
	}{
		\gdef\@orcidicon{\textcolor{orcidlogocol}{\aiOrcid}}
	}
	\gdef\@orcid{\href{https://orcid.org/#2}{#2}}
}

\newcommand{\addoptionalinfo}[2]{
	\ifdef{#2}{
		#1 & #2 \\
	}{}
}

\newcommand{\finalslide}{
	
  \ifdef{\@email}{}{\PackageError{finalslide}{No email specified!}{}}
	
  \begin{frame}[plain]
    \begin{tikzpicture}[overlay, remember picture]
      \clip (current page.north west) rectangle (current page.south east);

      % Background
      \shade[%
        top color=uniSlightblue,
        bottom color=uniSblue,
        shading angle=-45,
        %opacity=.8
        ]
        (current page.north west) rectangle (current page.south east);
        
        \node[anchor=north west] at ([xshift=1cm, yshift=-1cm]current page.north west) {\href{\universitylink}{\pgfuseimage{unilogo_w}}};
        
        \ifdef{\@websiteqr}{
        	\node[anchor=south west] at (current page.south west) {\@websiteqr};
        }{}

    \end{tikzpicture}

    \vspace{2cm}

    \begin{columns}[T]
      \begin{column}{2.5cm}
      	\begin{minipage}[c][0.75\textheight][c]{\columnwidth}
	    	\ifdef{\@speakerimage}{
		    	\begin{tikzpicture}
					\node[circle, minimum size=2.5cm, path picture={
						\node at (path picture bounding box.center){\includegraphics[width=2.5cm]{\@speakerimage}};}] {};
				\end{tikzpicture}
			}{}
   		\end{minipage}
      \end{column}
      \begin{column}{.75\textwidth}
      	\begin{minipage}[c][0.75\textheight][c]{\columnwidth}

        \begin{beamercolorbox}
          {palette tertiary}
          \def\arraystretch{1.1}
          \begin{tabular}{rl}
            \multicolumn{2}{l}{\insertauthor} \\ % TODO: newline
            \ifdef{\@institute}{\multicolumn{2}{l}{\insertinstitute} \\}{}
            \ifdef{\@department}{\multicolumn{2}{l}{\itshape\insertdepartment} \\}{}
          \end{tabular}\\[2ex]
      	  
      	  {
	      	  \def\arraystretch{1.2}
	      	  \footnotesize
	          \begin{tabularx}{\columnwidth}{r X}
	            \@emailicon & \@email \\
	            \addoptionalinfo{\@phoneicon}{\@phone}
	            \addoptionalinfo{\@faxicon}{\@fax}
	            \addoptionalinfo{\@addressicon}{\@address}
	            \addoptionalinfo{\@officehoursicon}{\@officehours}
	            \addoptionalinfo{\@websiteicon}{\@website}
	            \addoptionalinfo{\@orcidicon}{\@orcid}
	          \end{tabularx}
	      }
        \end{beamercolorbox}
      \end{minipage}
      \end{column}
    \end{columns}
  \end{frame}
}

\makeatother

\newcommand{\appendixslide}[1]{
	\appendix
	\input{#1}
}

\makeatletter
\newcommand{\bibresource}[1]{\gdef\@bibresource{#1}}
\ifdef{\@bibresource}{\addbibresource{\@bibresource}}{}

\newcommand{\bibliographyslide}[1][]{
	\ifdef{\@bibresource}{
		\ifthenelse{\isempty{#1}}{
			\iflanguage{ngerman}{
				\def\bibtitle{Quellen}
			}{
				\def\bibtitle{References}
			}
		}{
			\def\bibtitle{#1}
		}
		\begin{frame}{\bibtitle}
			\renewcommand*{\bibfont}{\tiny}
			\printbibliography
		\end{frame}
	}{
		\PackageError{Bibliography Frame}{Can't create bibliography frame since no bib resources are given!}{Please set bibresources to the path of your bibliography file.}
	}
}
\makeatother




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% section page %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setbeamertemplate{section page}%
{
  \addtocounter{framenumber}{-1}
  \begin{tikzpicture}[overlay, remember picture]
    \setlength{\circlesize}{.9\textheight}
    \clip (current page.north west) rectangle (current page.south east);
    \shade[%
      top color=uniSlightblue,
      bottom color=uniSblue,
      shading angle=-45]
      (current page.north west) rectangle (current page.south east);
    \node[%
      circle,
      fill=white,
      anchor=north west,
      minimum size=\circlesize,
      text width=.5\circlesize,
      align=left,
      font=\bfseries\Huge]
      (sectiontitle) at ([xshift=.1\circlesize, yshift=-.2\circlesize]current page.north west) {\insertsection};
    \setlength{\circlesize}{.2\textheight}
    \node[%
      circle,
      fill=uniSgray,
      text=white,
      anchor=center,
      minimum size=\circlesize,
      align=left,
      font=\bfseries\Huge]
      at ([xshift=-.1\circlesize, yshift=-.3\circlesize]sectiontitle.south east) {\thesection};
  \end{tikzpicture}
}


\setbeamertemplate{section in toc}{%
  \usebeamercolor[bg]{item projected}%
  \begin{tikzpicture}[node distance=.5em]
    \node[anchor=base, baseline, fill=uniSgray, text=white, circle, inner sep=0pt, minimum size=2em] (no) {\inserttocsectionnumber};
    \node[right=of no] {\color{uniSblue} \inserttocsection};
  \end{tikzpicture}
}

\setbeamertemplate{frametitle}%
{
  \nointerlineskip
  \begin{beamercolorbox}[leftskip=2ex, ht=2em,wd=\paperwidth]{frametitle}
    \bfseries\Large\insertframetitle\strut
  \end{beamercolorbox}
}

\setbeamertemplate{itemize/enumerate body begin}{\footnotesize}

\setbeamertemplate{itemize/enumerate subbody begin}{\footnotesize}

\setbeamertemplate{itemize item}{%
  \usebeamercolor[bg]{item projected}%
  \begin{tikzpicture}
    \draw[uniSlightblue,fill=uniSlightblue, opacity=0] (0,0) circle (.1695em);
    \draw[uniSlightblue,fill=uniSlightblue] (.1695em, .1695em) circle (.1695em);
  \end{tikzpicture}
}

\setbeamertemplate{bibliography item}{\insertbiblabel}

\setbeamertemplate{blocks}[rounded][shadow=true]

\defbeamertemplate{note page}{notepageuniS}
{
  \insertvrule{0.45\paperheight}{uniSgray!20}%
  \vskip-0.45\paperheight
  \insertslideintonotes{0.45}

  \noindent\hspace{1em}\begin{minipage}{.9\paperwidth}
    \footnotesize
    \setlist{noitemsep}
    \insertnote
  \end{minipage}
}

\setbeamertemplate{note page}[notepageuniS]

\mode<all>
